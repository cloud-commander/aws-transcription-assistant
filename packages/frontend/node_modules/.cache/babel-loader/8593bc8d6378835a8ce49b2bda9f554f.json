{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fromCognitoIdentityPool = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar client_cognito_identity_1 = require(\"@aws-sdk/client-cognito-identity\");\n\nvar property_provider_1 = require(\"@aws-sdk/property-provider\");\n\nvar fromCognitoIdentity_1 = require(\"./fromCognitoIdentity\");\n\nvar localStorage_1 = require(\"./localStorage\");\n\nvar resolveLogins_1 = require(\"./resolveLogins\");\n/**\n * Retrieves or generates a unique identifier using Amazon Cognito's `GetId`\n * operation, then generates temporary AWS credentials using Amazon Cognito's\n * `GetCredentialsForIdentity` operation.\n *\n * Results from `GetId` are cached internally, but results from\n * `GetCredentialsForIdentity` are not.\n */\n\n\nfunction fromCognitoIdentityPool(_a) {\n  var _this = this;\n\n  var accountId = _a.accountId,\n      _b = _a.cache,\n      cache = _b === void 0 ? localStorage_1.localStorage() : _b,\n      client = _a.client,\n      customRoleArn = _a.customRoleArn,\n      identityPoolId = _a.identityPoolId,\n      logins = _a.logins,\n      _c = _a.userIdentifier,\n      userIdentifier = _c === void 0 ? !logins || Object.keys(logins).length === 0 ? \"ANONYMOUS\" : undefined : _c;\n  var cacheKey = userIdentifier ? \"aws:cognito-identity-credentials:\" + identityPoolId + \":\" + userIdentifier : undefined;\n\n  var provider = function () {\n    return tslib_1.__awaiter(_this, void 0, void 0, function () {\n      var identityId, _a, _b, IdentityId, _c, _d, _e, _f, _g;\n\n      return tslib_1.__generator(this, function (_h) {\n        switch (_h.label) {\n          case 0:\n            _a = cacheKey;\n            if (!_a) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , cache.getItem(cacheKey)];\n\n          case 1:\n            _a = _h.sent();\n            _h.label = 2;\n\n          case 2:\n            identityId = _a;\n            if (!!identityId) return [3\n            /*break*/\n            , 7];\n            _d = (_c = client).send;\n            _e = client_cognito_identity_1.GetIdCommand.bind;\n            _f = {\n              AccountId: accountId,\n              IdentityPoolId: identityPoolId\n            };\n            if (!logins) return [3\n            /*break*/\n            , 4];\n            return [4\n            /*yield*/\n            , resolveLogins_1.resolveLogins(logins)];\n\n          case 3:\n            _g = _h.sent();\n            return [3\n            /*break*/\n            , 5];\n\n          case 4:\n            _g = undefined;\n            _h.label = 5;\n\n          case 5:\n            return [4\n            /*yield*/\n            , _d.apply(_c, [new (_e.apply(client_cognito_identity_1.GetIdCommand, [void 0, (_f.Logins = _g, _f)]))()])];\n\n          case 6:\n            _b = _h.sent().IdentityId, IdentityId = _b === void 0 ? throwOnMissingId() : _b;\n            identityId = IdentityId;\n\n            if (cacheKey) {\n              Promise.resolve(cache.setItem(cacheKey, identityId)).catch(function () {});\n            }\n\n            _h.label = 7;\n\n          case 7:\n            provider = fromCognitoIdentity_1.fromCognitoIdentity({\n              client: client,\n              customRoleArn: customRoleArn,\n              logins: logins,\n              identityId: identityId\n            });\n            return [2\n            /*return*/\n            , provider()];\n        }\n      });\n    });\n  };\n\n  return function () {\n    return provider().catch(function (err) {\n      return tslib_1.__awaiter(_this, void 0, void 0, function () {\n        return tslib_1.__generator(this, function (_a) {\n          if (cacheKey) {\n            Promise.resolve(cache.removeItem(cacheKey)).catch(function () {});\n          }\n\n          throw err;\n        });\n      });\n    });\n  };\n}\n\nexports.fromCognitoIdentityPool = fromCognitoIdentityPool;\n\nfunction throwOnMissingId() {\n  throw new property_provider_1.ProviderError(\"Response from Amazon Cognito contained no identity ID\");\n}","map":{"version":3,"sources":["../../src/fromCognitoIdentityPool.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.fromCognitoIdentityPool = void 0;\nvar tslib_1 = require(\"tslib\");\nvar client_cognito_identity_1 = require(\"@aws-sdk/client-cognito-identity\");\nvar property_provider_1 = require(\"@aws-sdk/property-provider\");\nvar fromCognitoIdentity_1 = require(\"./fromCognitoIdentity\");\nvar localStorage_1 = require(\"./localStorage\");\nvar resolveLogins_1 = require(\"./resolveLogins\");\n/**\n * Retrieves or generates a unique identifier using Amazon Cognito's `GetId`\n * operation, then generates temporary AWS credentials using Amazon Cognito's\n * `GetCredentialsForIdentity` operation.\n *\n * Results from `GetId` are cached internally, but results from\n * `GetCredentialsForIdentity` are not.\n */\nfunction fromCognitoIdentityPool(_a) {\n    var _this = this;\n    var accountId = _a.accountId, _b = _a.cache, cache = _b === void 0 ? localStorage_1.localStorage() : _b, client = _a.client, customRoleArn = _a.customRoleArn, identityPoolId = _a.identityPoolId, logins = _a.logins, _c = _a.userIdentifier, userIdentifier = _c === void 0 ? !logins || Object.keys(logins).length === 0 ? \"ANONYMOUS\" : undefined : _c;\n    var cacheKey = userIdentifier ? \"aws:cognito-identity-credentials:\" + identityPoolId + \":\" + userIdentifier : undefined;\n    var provider = function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n        var identityId, _a, _b, IdentityId, _c, _d, _e, _f, _g;\n        return tslib_1.__generator(this, function (_h) {\n            switch (_h.label) {\n                case 0:\n                    _a = cacheKey;\n                    if (!_a) return [3 /*break*/, 2];\n                    return [4 /*yield*/, cache.getItem(cacheKey)];\n                case 1:\n                    _a = (_h.sent());\n                    _h.label = 2;\n                case 2:\n                    identityId = _a;\n                    if (!!identityId) return [3 /*break*/, 7];\n                    _d = (_c = client).send;\n                    _e = client_cognito_identity_1.GetIdCommand.bind;\n                    _f = {\n                        AccountId: accountId,\n                        IdentityPoolId: identityPoolId\n                    };\n                    if (!logins) return [3 /*break*/, 4];\n                    return [4 /*yield*/, resolveLogins_1.resolveLogins(logins)];\n                case 3:\n                    _g = _h.sent();\n                    return [3 /*break*/, 5];\n                case 4:\n                    _g = undefined;\n                    _h.label = 5;\n                case 5: return [4 /*yield*/, _d.apply(_c, [new (_e.apply(client_cognito_identity_1.GetIdCommand, [void 0, (_f.Logins = _g,\n                                _f)]))()])];\n                case 6:\n                    _b = (_h.sent()).IdentityId, IdentityId = _b === void 0 ? throwOnMissingId() : _b;\n                    identityId = IdentityId;\n                    if (cacheKey) {\n                        Promise.resolve(cache.setItem(cacheKey, identityId)).catch(function () { });\n                    }\n                    _h.label = 7;\n                case 7:\n                    provider = fromCognitoIdentity_1.fromCognitoIdentity({\n                        client: client,\n                        customRoleArn: customRoleArn,\n                        logins: logins,\n                        identityId: identityId,\n                    });\n                    return [2 /*return*/, provider()];\n            }\n        });\n    }); };\n    return function () {\n        return provider().catch(function (err) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                if (cacheKey) {\n                    Promise.resolve(cache.removeItem(cacheKey)).catch(function () { });\n                }\n                throw err;\n            });\n        }); });\n    };\n}\nexports.fromCognitoIdentityPool = fromCognitoIdentityPool;\nfunction throwOnMissingId() {\n    throw new property_provider_1.ProviderError(\"Response from Amazon Cognito contained no identity ID\");\n}\n//# sourceMappingURL=fromCognitoIdentityPool.js.map"]},"metadata":{},"sourceType":"script"}